<!DOCTYPE html>
<html lang="fr-BE">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Réservation reçue | Lo en terre</title>
  <meta name="description"
    content="Votre réservation a bien été reçue. La confirmation vous sera envoyée après réception du paiement." />
  <link rel="canonical" href="https://loenterre.com/reservation-received/" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;500;600;700&family=Cormorant+Garamond:wght@500;600;700&display=swap" />

  <link href="../src/assets/img/logo.png" rel="icon" />
  <link href="../src/assets/img/logo.png" rel="apple-touch-icon" />

  <link rel="stylesheet" href="../src/assets/vendor/bootstrap/css/bootstrap.min.css" />
  <link rel="stylesheet" href="../src/assets/vendor/bootstrap-icons/bootstrap-icons.css" />
  <link rel="stylesheet" href="../src/assets/css/style.css" />

  <style>
    :root {
      --dev-banner-height: 56px;
    }

    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background:
        radial-gradient(circle at 18% 18%, #fdf3e4 0%, rgba(253, 243, 228, 0) 36%),
        radial-gradient(circle at 80% 10%, #efd9c0 0%, rgba(239, 217, 192, 0) 46%),
        #f4efe6;
      color: #4a2a12;
      font-family: "Source Sans 3", sans-serif;
    }

    .dev-warning-banner {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 999;
      background: #b71c1c;
      color: #fff;
      text-align: center;
      padding: 10px 16px;
      font-weight: 700;
      font-size: 0.92rem;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      box-shadow: 0 12px 20px rgba(0, 0, 0, 0.18);
    }

    .dev-warning-banner span {
      display: block;
      font-weight: 600;
      font-size: 0.78rem;
      letter-spacing: 0.3px;
      text-transform: none;
    }

    body.dev-warning-active {
      padding-top: var(--dev-banner-height);
    }

    .confirmation-hero {
      flex: 1;
      display: flex;
      align-items: center;
      padding: 80px 0;
    }

    .confirmation-card {
      background: linear-gradient(180deg, #fffdf8, #fff6ea);
      border-radius: 22px;
      padding: 42px;
      box-shadow: 0 26px 50px rgba(81, 47, 24, 0.13);
      border: 1px solid #e7d3be;
    }

    .confirmation-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(240, 147, 0, 0.12);
      color: #dd8014;
      padding: 6px 14px;
      border-radius: 999px;
      font-weight: 700;
      text-transform: uppercase;
      font-size: 0.75rem;
      letter-spacing: 1px;
    }

    .confirmation-title {
      font-family: "Cormorant Garamond", serif;
      font-size: clamp(2rem, 3vw, 2.8rem);
      margin: 18px 0 12px;
      color: #6c3b17;
    }

    .confirmation-lead {
      font-size: 1.1rem;
      color: #6b5a4b;
      margin-bottom: 22px;
    }

    .confirmation-steps {
      margin: 0 0 26px;
      padding-left: 1.2rem;
      color: #6b5a4b;
    }

    .confirmation-steps li {
      margin-bottom: 8px;
    }

    .confirmation-alert {
      display: flex;
      gap: 12px;
      align-items: flex-start;
      background: #fff7ed;
      border: 1px solid #fde2c4;
      border-radius: 14px;
      padding: 16px;
      color: #7a4a1f;
      margin-bottom: 28px;
    }

    .confirmation-details {
      border-top: 1px solid #f0e6db;
      padding-top: 22px;
      margin-top: 18px;
    }

    .confirmation-details-title {
      font-family: "Cormorant Garamond", serif;
      font-size: 1.3rem;
      font-weight: 700;
      color: #6c3b17;
      margin-bottom: 14px;
    }

    .confirmation-details-grid {
      display: grid;
      grid-template-columns: 150px 1fr;
      gap: 10px 16px;
      margin: 0;
    }

    .confirmation-details-grid dt {
      font-weight: 600;
      color: #6c3b17;
    }

    .confirmation-details-grid dd {
      margin: 0;
      color: #6b5a4b;
    }

    .confirmation-calendar {
      margin-top: 18px;
    }

    .confirmation-calendar-title {
      font-size: 1rem;
      font-weight: 700;
      color: #6c3b17;
      margin-bottom: 10px;
    }

    .confirmation-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .confirmation-actions .btn {
      font-weight: 600;
    }

    .confirmation-contact {
      margin-top: 26px;
      display: grid;
      gap: 8px;
      color: #6b5a4b;
      font-size: 0.98rem;
    }

    @media (max-width: 575px) {
      .confirmation-card {
        padding: 32px 26px;
      }

      .confirmation-details-grid {
        grid-template-columns: 1fr;
      }

      .confirmation-details-grid dt {
        margin-top: 8px;
      }
    }
  </style>
</head>

<body>
  <div id="dev-warning" class="dev-warning-banner" role="alert" hidden>
    Version de test — ne pas utiliser pour des réservations réelles
    <span>Cette page est uniquement destinée aux essais.</span>
  </div>

  <main class="confirmation-hero">
    <div class="container">
      <div class="confirmation-card">
        <span class="confirmation-badge"><i class="bi bi-check-circle"></i>Réservation reçue</span>
        <h1 class="confirmation-title">Merci pour votre réservation</h1>
        <p class="confirmation-lead">
          <span id="guest-name-fallback">Merci !</span>
          <span id="guest-name-wrap" hidden>Merci <span id="guest-name"></span> !</span>
          Votre réservation a bien été enregistrée. La confirmation vous sera envoyée après réception du paiement.
        </p>

        <ul class="confirmation-steps">
          <li>Vous recevrez prochainement un email récapitulatif avec les prochaines étapes.</li>
          <li>La place est confirmée dès réception du paiement.</li>
          <li>Si besoin, nous vous contacterons pour ajuster le créneau.</li>
        </ul>

        <div class="confirmation-alert">
          <i class="bi bi-envelope-open"></i>
          <div>
            Pensez à vérifier votre boîte spam/courriers indésirables si l'email tarde à arriver.
          </div>
        </div>

        <div id="booking-details" class="confirmation-details" hidden>
          <div class="confirmation-details-title">Détails de la réservation</div>
          <dl id="booking-details-list" class="confirmation-details-grid"></dl>
          <div id="calendar-actions" class="confirmation-calendar" hidden>
            <div class="confirmation-calendar-title">Ajouter au calendrier</div>
            <div class="confirmation-actions">
              <a id="calendar-google" class="btn btn-outline-dark" target="_blank" rel="noopener">
                <i class="bi bi-google me-2"></i>Google Calendar
              </a>
              <a id="calendar-ics" class="btn btn-outline-dark">
                <i class="bi bi-calendar2-week me-2"></i>Fichier ICS
              </a>
            </div>
          </div>
        </div>

        <div class="confirmation-actions">
          <a href="../" class="btn btn-warning">
            <i class="bi bi-arrow-left me-2"></i>Retour à l'accueil
          </a>
          <a href="../reserver/" class="btn btn-outline-dark">
            Voir les ateliers
          </a>
          <a href="../bon-cadeau/" class="btn btn-outline-dark">
            Commander un bon cadeau
          </a>
        </div>

        <div class="confirmation-contact">
          <div><i class="bi bi-envelope me-2"></i>laurence.greday@gmail.com</div>
          <div><i class="bi bi-telephone me-2"></i>+32 497 108540</div>
        </div>
      </div>
    </div>
  </main>

  <script src="../src/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script>
    (function () {
      const devHosts = new Set(["dev.loenterre.com"]);
      if (!devHosts.has(window.location.hostname)) return;
      const banner = document.getElementById("dev-warning");
      if (!banner) return;
      banner.hidden = false;
      document.body.classList.add("dev-warning-active");
    })();

    (function () {
      const params = new URLSearchParams(window.location.search);
      const name = params.get("attendeeName") || params.get("name") || params.get("inviteeName");
      if (!name) return;
      const safeName = name.trim();
      if (!safeName) return;
      const nameWrap = document.getElementById("guest-name-wrap");
      const fallback = document.getElementById("guest-name-fallback");
      const nameTarget = document.getElementById("guest-name");
      if (!nameWrap || !fallback || !nameTarget) return;
      nameTarget.textContent = safeName;
      nameWrap.hidden = false;
      fallback.hidden = true;
    })();

    (function () {
      const params = new URLSearchParams(window.location.search);
      const detailsWrap = document.getElementById("booking-details");
      const detailsList = document.getElementById("booking-details-list");
      if (!detailsWrap || !detailsList) return;

      const getFirstParam = (keys) => {
        for (const key of keys) {
          const value = params.get(key);
          if (!value) continue;
          const trimmed = value.trim();
          if (trimmed) return trimmed;
        }
        return "";
      };

      const toTitle = (value) => {
        if (!value) return "";
        const cleaned = value.replace(/[-_]+/g, " ").trim();
        return cleaned.charAt(0).toUpperCase() + cleaned.slice(1);
      };

      const parseDate = (value) => {
        if (!value) return null;
        const date = new Date(value);
        if (Number.isNaN(date.getTime())) return null;
        return date;
      };

      const capFirst = (value) => {
        if (!value) return "";
        return value.charAt(0).toUpperCase() + value.slice(1);
      };

      const maskReference = (value) => {
        if (!value) return "";
        const compact = value.replace(/\s+/g, "");
        if (compact.length <= 10) return value;
        return `${compact.slice(0, 4)}…${compact.slice(-4)}`;
      };

      const formatCalendarDate = (date) =>
        date
          .toISOString()
          .replace(/[-:]/g, "")
          .replace(/\.\d{3}Z$/, "Z");

      const title =
        getFirstParam(["title"]) ||
        toTitle(getFirstParam(["type", "eventTypeSlug"]));
      const startParam = getFirstParam([
        "startTime",
        "attendeeStartTime",
        "hostStartTime",
      ]);
      const endParam = getFirstParam(["endTime"]);
      const location = getFirstParam(["location"]);
      const host = getFirstParam(["hostName", "user"]);
      const attendee = getFirstParam(["attendeeName", "name", "inviteeName"]);
      const email = getFirstParam(["email"]);

      const startDate = parseDate(startParam);
      const endDate = parseDate(endParam);
      const dateOptions = {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric",
      };
      const timeOptions = { hour: "2-digit", minute: "2-digit" };
      let dateValue = "";
      let timeValue = "";

      if (startDate) {
        dateValue = capFirst(startDate.toLocaleDateString("fr-BE", dateOptions));
        if (endDate) {
          const sameDay =
            startDate.getFullYear() === endDate.getFullYear() &&
            startDate.getMonth() === endDate.getMonth() &&
            startDate.getDate() === endDate.getDate();
          if (sameDay) {
            timeValue = `${startDate.toLocaleTimeString(
              "fr-BE",
              timeOptions
            )} – ${endDate.toLocaleTimeString("fr-BE", timeOptions)}`;
          } else {
            timeValue = `${capFirst(
              startDate.toLocaleDateString("fr-BE", dateOptions)
            )}, ${startDate.toLocaleTimeString(
              "fr-BE",
              timeOptions
            )} – ${capFirst(
              endDate.toLocaleDateString("fr-BE", dateOptions)
            )}, ${endDate.toLocaleTimeString("fr-BE", timeOptions)}`;
          }
        }
      }

      const items = [];
      if (title) items.push({ label: "Atelier", value: title });
      if (dateValue) items.push({ label: "Date", value: dateValue });
      if (timeValue) items.push({ label: "Horaire", value: timeValue });
      if (location) items.push({ label: "Lieu", value: location });
      if (host) items.push({ label: "Hôte", value: host });
      if (attendee) items.push({ label: "Participant", value: attendee });
      if (email) items.push({ label: "Email", value: email });

      if (!items.length) return;

      for (const item of items) {
        const term = document.createElement("dt");
        term.textContent = item.label;
        const detail = document.createElement("dd");
        detail.textContent = item.value;
        detailsList.append(term, detail);
      }

      detailsWrap.hidden = false;

      if (startDate) {
        const calendarTitle = title || "Atelier Lo en terre";
        const calendarStart = formatCalendarDate(startDate);
        const calendarEnd = formatCalendarDate(
          endDate && endDate.getTime() > startDate.getTime()
            ? endDate
            : new Date(startDate.getTime() + 2 * 60 * 60 * 1000)
        );
        const descriptionParts = [];
        if (attendee) descriptionParts.push(`Participant : ${attendee}`);
        if (host) descriptionParts.push(`Hôte : ${host}`);
        const description = descriptionParts.join("\\n");

        const googleLink = document.getElementById("calendar-google");
        if (googleLink) {
          const googleParams = new URLSearchParams({
            action: "TEMPLATE",
            text: calendarTitle,
            dates: `${calendarStart}/${calendarEnd}`,
          });
          if (location) googleParams.set("location", location);
          if (description) googleParams.set("details", description);
          googleLink.href = `https://calendar.google.com/calendar/render?${googleParams.toString()}`;
        }

        const icsLink = document.getElementById("calendar-ics");
        if (icsLink) {
          const icsLines = [
            "BEGIN:VCALENDAR",
            "VERSION:2.0",
            "PRODID:-//Lo en terre//Reservation//FR",
            "BEGIN:VEVENT",
            `UID:${calendarStart}@loenterre.com`,
            `DTSTAMP:${formatCalendarDate(new Date())}`,
            `DTSTART:${calendarStart}`,
            `DTEND:${calendarEnd}`,
            `SUMMARY:${calendarTitle}`,
            location ? `LOCATION:${location}` : null,
            description ? `DESCRIPTION:${description}` : null,
            "END:VEVENT",
            "END:VCALENDAR",
          ].filter(Boolean);

          const icsBlob = new Blob([icsLines.join("\r\n")], {
            type: "text/calendar;charset=utf-8",
          });
          const icsUrl = URL.createObjectURL(icsBlob);
          icsLink.href = icsUrl;
          icsLink.download = "reservation.ics";
        }

        const calendarWrap = document.getElementById("calendar-actions");
        if (calendarWrap) calendarWrap.hidden = false;
      }
    })();
  </script>
</body>

</html>
